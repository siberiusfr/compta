# Instructions pour Claude Code - Infrastructure COMPTA

Tu es un ensemble d'agents sp√©cialis√©s qui vont cr√©er une infrastructure compl√®te pour l'application COMPTA (ERP comptable tunisien).

## Contexte du projet

**Application:** COMPTA - ERP comptable pour le march√© tunisien
**Architecture:** Microservices (Spring Boot) + PostgreSQL + Redis + Vue 3 + Flutter
**H√©bergement:** Hetzner Cloud
**Environnements:** dev, staging, production

## Structure compl√®te √† cr√©er
```
compta-infrastructure/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ AGENTS.md
‚îÇ
‚îú‚îÄ‚îÄ terraform/
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ network/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ firewall/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ volume/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ terraform.tfvars.example
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backend.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ files/
‚îÇ       ‚îú‚îÄ‚îÄ cloud-init-base.yml
‚îÇ       ‚îú‚îÄ‚îÄ cloud-init-database.yml
‚îÇ       ‚îú‚îÄ‚îÄ cloud-init-application.yml
‚îÇ       ‚îî‚îÄ‚îÄ cloud-init-monitoring.yml
‚îÇ
‚îú‚îÄ‚îÄ ansible/
‚îÇ   ‚îú‚îÄ‚îÄ ansible.cfg
‚îÇ   ‚îú‚îÄ‚îÄ requirements.yml
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ inventories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hosts.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ group_vars/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ all.yml
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ all.vault.yml
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ database.yml
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ monitoring.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ site.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup-base.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup-database.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup-application.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup-monitoring.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backup.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ restore.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database-migration.yml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ maintenance.yml
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ssh.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ firewall.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fail2ban.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ unattended-upgrades.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ monitoring.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logrotate.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ swap.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sshd_hardening.conf.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jail.local.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sshd.local.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 50unattended-upgrades.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ node_exporter.service.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docker-logrotate.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ defaults/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgresql/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prerequisites.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ install.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data-directory.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configure.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authentication.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ databases.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ extensions.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backup.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ maintenance.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ monitoring.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verify.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgresql.conf.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pg_hba.conf.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pg_ident.conf.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backup.sh.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ restore.sh.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ archive_wal.sh.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ maintenance.sh.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vacuum.sh.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres_exporter.env.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres_exporter.service.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ postgres_exporter_queries.yml.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ defaults/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pgbouncer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pgbouncer.ini.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userlist.txt.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ defaults/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prerequisites.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ install.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configure.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ networking.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ compose.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registry.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ monitoring.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verify.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daemon.json.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage-driver.conf.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docker-limits.conf.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docker-logrotate.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ defaults/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (structure similaire)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ monitoring/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (structure similaire)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backup/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (structure similaire)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signoz/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ (structure similaire)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ playbooks/tasks/
‚îÇ       ‚îú‚îÄ‚îÄ pre-deployment-checks.yml
‚îÇ       ‚îú‚îÄ‚îÄ backup-deployment.yml
‚îÇ       ‚îú‚îÄ‚îÄ pull-images.yml
‚îÇ       ‚îú‚îÄ‚îÄ deploy-configs.yml
‚îÇ       ‚îú‚îÄ‚îÄ deploy-compose.yml
‚îÇ       ‚îú‚îÄ‚îÄ run-migrations.yml
‚îÇ       ‚îú‚îÄ‚îÄ health-checks.yml
‚îÇ       ‚îú‚îÄ‚îÄ update-metadata.yml
‚îÇ       ‚îî‚îÄ‚îÄ migration/
‚îÇ           ‚îú‚îÄ‚îÄ pre-checks.yml
‚îÇ           ‚îú‚îÄ‚îÄ backup.yml
‚îÇ           ‚îú‚îÄ‚îÄ execute.yml
‚îÇ           ‚îú‚îÄ‚îÄ post-checks.yml
‚îÇ           ‚îî‚îÄ‚îÄ notify.yml
‚îÇ
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ applications/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api-gateway/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth-service/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accounting-service/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reporting-service/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ compose/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml.j2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .env.production.example
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ (m√™me structure)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ monitoring/
‚îÇ       ‚îú‚îÄ‚îÄ docker-compose.signoz.yml
‚îÇ       ‚îú‚îÄ‚îÄ docker-compose.otel.yml
‚îÇ       ‚îî‚îÄ‚îÄ otel-collector-config.yml
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ deploy/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy-production.sh
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy-staging.sh
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rollback.sh
‚îÇ   ‚îú‚îÄ‚îÄ backup/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backup-db.sh
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ restore-db.sh
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verify-backup.sh
‚îÇ   ‚îú‚îÄ‚îÄ maintenance/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rotate-logs.sh
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cleanup.sh
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health-check.sh
‚îÇ   ‚îî‚îÄ‚îÄ setup/
‚îÇ       ‚îî‚îÄ‚îÄ generate-secrets.sh
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ architecture.md
‚îÇ   ‚îú‚îÄ‚îÄ deployment.md
‚îÇ   ‚îú‚îÄ‚îÄ runbook.md
‚îÇ   ‚îú‚îÄ‚îÄ disaster-recovery.md
‚îÇ   ‚îú‚îÄ‚îÄ monitoring.md
‚îÇ   ‚îî‚îÄ‚îÄ troubleshooting.md
‚îÇ
‚îî‚îÄ‚îÄ .github/
    ‚îî‚îÄ‚îÄ workflows/
        ‚îú‚îÄ‚îÄ deploy-production.yml
        ‚îú‚îÄ‚îÄ deploy-staging.yml
        ‚îú‚îÄ‚îÄ rollback.yml
        ‚îî‚îÄ‚îÄ database-migration.yml
```

## Instructions par agent

### Agent 1: Infrastructure Architect (Terraform)

**T√¢che:** Cr√©er l'infrastructure Terraform compl√®te

**Sp√©cifications techniques:**
- Hetzner Cloud provider
- Modules r√©utilisables (server, network, firewall, volume)
- 3 environnements (production, staging, dev)
- Production: 
  - 1 serveur DB (cpx41 - 16GB RAM, 8 vCPU)
  - 2 serveurs App (cpx31 - 8GB RAM, 4 vCPU)
  - 1 serveur Monitoring (cx22 - 4GB RAM, 2 vCPU)
  - Load Balancer
  - R√©seau priv√© 10.0.0.0/16
- Staging/Dev: configs r√©duites

**Fichiers √† cr√©er:**
- Tous les fichiers dans `terraform/`
- Cloud-init pour bootstrap automatique
- Remote state avec S3
- Variables typ√©es avec validation
- Outputs pour Ansible

**Contraintes:**
- Protection delete pour production
- Snapshots automatiques
- Firewall par d√©faut deny
- SSH sur port custom (2222)
- Tags/labels sur toutes ressources

### Agent 2: Configuration Manager (Ansible)

**T√¢che:** Cr√©er tous les r√¥les et playbooks Ansible

**R√¥les √† cr√©er:**

1. **common:** Configuration de base tous serveurs
   - SSH hardening (cl√©s uniquement, port 2222)
   - UFW firewall
   - fail2ban
   - Unattended upgrades
   - Node exporter
   - Swap configuration
   - Users management

2. **postgresql:** Installation et configuration PostgreSQL 16
   - Installation depuis repo PostgreSQL officiel
   - Data directory sur volume d√©di√© (/mnt/postgres_data)
   - Configuration optimis√©e (voir config postgresql.conf fournie)
   - pg_hba.conf s√©curis√© (localhost + r√©seau priv√© uniquement)
   - Cr√©ation databases et users
   - Extensions (pg_stat_statements, uuid-ossp, pgcrypto)
   - Backup automatique quotidien
   - Maintenance scripts (vacuum, reindex)
   - Monitoring avec postgres_exporter

3. **pgbouncer:** Connection pooling
   - Installation et configuration
   - Pool mode: transaction
   - Max 1000 client connections, 25 pool size
   - Auth SCRAM-SHA-256
   - Monitoring avec pgbouncer_exporter

4. **docker:** Installation Docker
   - Docker CE depuis repo officiel
   - Docker Compose v2
   - Configuration daemon.json (logging, storage driver)
   - Users dans groupe docker
   - Registry priv√© authentication
   - cAdvisor pour monitoring

5. **monitoring:** Stack monitoring
   - Installation exporters
   - Configuration OpenTelemetry Collector
   - SigNoz deployment
   - Dashboards et alertes

6. **backup:** Gestion backups
   - Scripts backup/restore
   - Rclone pour remote storage
   - Rotation automatique
   - V√©rification int√©grit√©

**Playbooks principaux:**

1. **site.yml:** Playbook principal pour configurer tous serveurs
2. **deploy.yml:** D√©ploiement application avec rolling update
3. **backup.yml:** Backup manuel ou automatique
4. **restore.yml:** Restore avec confirmations
5. **database-migration.yml:** Gestion migrations Flyway
6. **maintenance.yml:** Maintenance r√©guli√®re

**Inventaires:**
- Structure par environnement
- group_vars avec variables par groupe
- Secrets avec Ansible Vault
- Variables diff√©rentes par env (prod/staging/dev)

**Contraintes:**
- Idempotence garantie
- Handlers pour reloads/restarts
- Error handling robuste
- Logging de toutes op√©rations
- Dry-run support o√π applicable

### Agent 3: Container Orchestrator (Docker)

**T√¢che:** Cr√©er configuration Docker compl√®te

**Dockerfiles pour microservices:**
```dockerfile
# Multi-stage build exemple
FROM maven:3.9-eclipse-temurin-21 AS build
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline
COPY src ./src
RUN mvn package -DskipTests

FROM eclipse-temurin:21-jre-alpine
RUN apk add --no-cache curl
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
RUN addgroup -S spring && adduser -S spring -G spring
USER spring:spring
EXPOSE 8080
HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**Docker Compose par environnement:**

Production:
- Services: api-gateway, auth-service, accounting-service, reporting-service, redis, caddy
- Health checks sur tous services
- Resource limits (CPU, RAM)
- Logging configur√© (json-file, rotation)
- Networks: backend (priv√©), frontend (public)
- Volumes pour persistance
- Restart policy: unless-stopped

Staging:
- M√™me structure mais ressources r√©duites
- Ports debug expos√©s
- Logging plus verbeux

Dev:
- Ressources minimales
- Hot reload si possible
- Tous ports expos√©s

**Caddyfile pour reverse proxy:**
```caddyfile
compta.tn {
    reverse_proxy api-gateway:8080
    encode gzip
    header {
        Strict-Transport-Security "max-age=31536000"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
    }
    log {
        output file /var/log/caddy/access.log
    }
}
```

**Contraintes:**
- Images optimis√©es (taille minimale)
- Multi-stage builds
- Non-root user
- Security scanning (Trivy)
- Versioning semantic

### Agent 4: Database Engineer (PostgreSQL)

**T√¢che:** Configuration PostgreSQL production-ready

**Configuration PostgreSQL (postgresql.conf):**
- M√©moire: shared_buffers 4GB, effective_cache_size 12GB
- Connexions: max 200 (avec PgBouncer)
- WAL: archiving activ√©, replication ready
- Autovacuum: optimis√©
- Logging: queries > 500ms
- Stats: pg_stat_statements activ√©
- Locale: fr_TN.UTF-8
- Timezone: Africa/Tunis

**PgBouncer:**
- Transaction pooling mode
- 1000 max client conn ‚Üí 25 pool size
- Auth fichier avec SCRAM-SHA-256
- Timeouts configur√©s
- Stats collect√©es

**Backup strategy:**
- Quotidien: pg_dump (custom + SQL gzip)
- WAL archiving continu
- Retention 30 jours local
- Upload vers remote storage (rclone)
- V√©rification int√©grit√© automatique
- Restore test√© r√©guli√®rement

**Migrations:**
- Flyway int√©gr√© dans Spring Boot
- Migrations versionn√©es (V1__, V2__, etc.)
- Validation avant apply
- Backup automatique avant migration
- Rollback plan

**Monitoring:**
- postgres_exporter (port 9187)
- M√©triques custom (queries lentes, bloat, etc.)
- Alertes: connexions, cache hit ratio, replication lag, disk space

**Contraintes:**
- Data checksums activ√©s
- SSL connections
- No superuser remote access
- Regular VACUUM et ANALYZE

### Agent 5: DevOps Engineer (CI/CD)

**T√¢che:** Cr√©er workflows GitHub Actions complets

**Workflows requis:**

1. **deploy-production.yml:**
   - Trigger: push sur main, tags v*.*.*
   - Jobs:
     - build-and-test (matrix: 4 services)
     - security-scan (Trivy, OWASP)
     - build-images (Docker multi-arch)
     - terraform-plan
     - deploy-infrastructure
     - configure-servers (Ansible)
     - deploy-application
     - post-deployment-tests (smoke, health)
     - notify (Slack)
   - Environnement: production (avec approval)

2. **deploy-staging.yml:**
   - Trigger: push sur develop
   - M√™me structure mais:
     - Pas d'approval requis
     - E2E tests (Playwright)
     - Performance tests (k6)
     - Environnement: staging

3. **rollback.yml:**
   - Trigger: workflow_dispatch (manuel)
   - Inputs: environment, version, reason
   - Confirmation requise
   - Rollback avec Ansible
   - Health checks post-rollback
   - Notification

4. **database-migration.yml:**
   - Trigger: workflow_dispatch
   - Actions: migrate, validate, info, repair
   - Dry-run option
   - Backup automatique avant migration
   - Validation post-migration

**Tests:**
- Unit tests (JUnit, Maven)
- Integration tests
- E2E tests (Playwright)
- Performance tests (k6)
- Security scans (Trivy, SonarQube)

**Secrets √† configurer:**
```
ANSIBLE_VAULT_PASSWORD
HCLOUD_TOKEN
REGISTRY_USERNAME
REGISTRY_PASSWORD
SSH_PRIVATE_KEY
STAGING_SSH_PRIVATE_KEY
PROD_SERVER_IP
STAGING_SERVER_IP
SLACK_WEBHOOK_URL
STAGING_TEST_USER
STAGING_TEST_PASSWORD
SONAR_TOKEN (optionnel)
```

**Contraintes:**
- Build cache optimis√©
- Parallel jobs quand possible
- Artifact retention configur√©
- Logs d√©taill√©s
- Rate limiting respect√©

### Agent 6: Monitoring Specialist

**T√¢che:** Impl√©menter observability compl√®te

**Stack monitoring:**
1. **OpenTelemetry Collector:**
   - Collecte traces, metrics, logs
   - Exporters vers SigNoz
   - Sampling intelligent
   - Batch processing

2. **SigNoz:**
   - D√©ploiement via Docker Compose
   - Dashboards pour:
     - Applications (APM)
     - PostgreSQL
     - Docker containers
     - Infrastructure (nodes)
   - Alertes configur√©es

3. **Exporters:**
   - node_exporter: tous serveurs (port 9100)
   - postgres_exporter: serveur DB (port 9187)
   - pgbouncer_exporter: serveur DB (port 9127)
   - cAdvisor: serveurs app (port 8080)

**M√©triques cl√©s:**

PostgreSQL:
- Connexions actives
- Cache hit ratio (> 99%)
- Queries lentes (> 500ms)
- Table bloat
- Replication lag
- Disk usage

Application:
- Request latency (p50, p95, p99)
- Error rate
- Throughput
- JVM metrics (heap, GC)

Infrastructure:
- CPU, RAM, Disk usage
- Network I/O
- Container health

**Alertes critiques:**
- PostgreSQL down
- Connexions > 80%
- Cache hit ratio < 95%
- Disk > 85%
- Service down
- Error rate spike

**Dashboards:**
- Overview g√©n√©ral
- PostgreSQL performance
- Application APM
- Infrastructure health

**Contraintes:**
- Retention donn√©es configur√©e
- Agr√©gation pour performance
- Alertes avec rate limiting
- Notification multi-canal

### Agent 7: Security Engineer

**T√¢che:** S√©curiser toute l'infrastructure

**S√©curit√© serveurs:**
1. SSH hardening:
   - Port custom 2222
   - Cl√©s uniquement (no password)
   - No root login
   - fail2ban configur√©

2. Firewall:
   - UFW par d√©faut deny
   - Whitelist IPs admin
   - Ports minimum ouverts
   - Logs activ√©s

3. Updates:
   - Unattended security updates
   - Notifications updates importantes

**S√©curit√© r√©seau:**
1. R√©seau priv√© Hetzner:
   - DB accessible que via r√©seau priv√©
   - Microservices sur r√©seau priv√©
   - Load balancer seul public

2. Firewall Hetzner:
   - Rules par serveur type
   - ICMP limit√©
   - Rate limiting

**S√©curit√© applicative:**
1. Secrets:
   - Ansible Vault pour configs
   - GitHub Secrets pour CI/CD
   - Jamais de secrets en clair
   - Rotation r√©guli√®re

2. SSL/TLS:
   - Let's Encrypt via Caddy
   - HSTS activ√©
   - TLS 1.2+ uniquement

3. Application:
   - JWT pour auth
   - CORS configur√©
   - Rate limiting
   - Input validation

**S√©curit√© Docker:**
1. Images:
   - Scan Trivy
   - Base images officielles
   - Non-root user
   - Read-only filesystem o√π possible

2. Runtime:
   - Resource limits
   - No privileged
   - Secrets via Docker secrets
   - Network isolation

**Audit et compliance:**
1. Logs centralis√©s
2. Audit trails
3. RGPD compliance (pour clients EU)
4. Backup chiffr√©

**Contraintes:**
- Security scans dans CI/CD
- Penetration testing r√©gulier
- Vulnerability management
- Incident response plan

### Agent 8: Documentation Writer

**T√¢che:** Documenter compl√®tement le projet

**Documents √† cr√©er:**

1. **README.md principal:**
   - Vue d'ensemble projet
   - Architecture diagram
   - Quick start guide
   - Structure projet
   - Pr√©requis
   - Installation
   - Utilisation
   - Contributing guidelines

2. **docs/architecture.md:**
   - Architecture compl√®te
   - Diagrammes (infrastructure, r√©seau, data flow)
   - Choix technologiques justifi√©s
   - Scalability considerations
   - Security architecture

3. **docs/deployment.md:**
   - Guide d√©ploiement pas-√†-pas
   - Environnements
   - Pr√©requis
   - Secrets √† configurer
   - Commandes d√©ploiement
   - V√©rifications post-d√©ploiement
   - Troubleshooting d√©ploiement

4. **docs/runbook.md:**
   - Op√©rations quotidiennes
   - Proc√©dures standards:
     - D√©ploiement
     - Rollback
     - Backup/restore
     - Scaling
     - Updates
   - Checks √† faire
   - Contacts

5. **docs/disaster-recovery.md:**
   - Sc√©narios de disaster
   - Recovery procedures
   - RTO/RPO d√©finis
   - Backup locations
   - Restore procedures
   - Tests DR

6. **docs/monitoring.md:**
   - Dashboards disponibles
   - M√©triques importantes
   - Alertes configur√©es
   - Proc√©dures d'investigation
   - Escalation

7. **docs/troubleshooting.md:**
   - Probl√®mes communs
   - Solutions
   - Logs √† checker
   - Commandes utiles
   - FAQ

**README pour chaque composant:**
- Modules Terraform
- R√¥les Ansible
- Services Docker

**Contraintes:**
- Markdown format√©
- Exemples concrets
- Diagrammes (Mermaid)
- Liens internes
- Maintenu √† jour

## Ordre d'ex√©cution

Ex√©cute les agents dans cet ordre:

1. **Infrastructure Architect** ‚Üí Cr√©e base Terraform
2. **Database Engineer** ‚Üí D√©finit configs PostgreSQL
3. **Configuration Manager** ‚Üí Cr√©e r√¥les Ansible
4. **Container Orchestrator** ‚Üí Configure Docker
5. **DevOps Engineer** ‚Üí Setup CI/CD
6. **Monitoring Specialist** ‚Üí Impl√©mente monitoring
7. **Security Engineer** ‚Üí S√©curise tout
8. **Documentation Writer** ‚Üí Documente tout

## Validation finale

Avant de consid√©rer termin√©, v√©rifie que:

- [ ] `terraform apply` fonctionne pour chaque env
- [ ] `ansible-playbook site.yml` configure serveurs
- [ ] `ansible-playbook deploy.yml` d√©ploie app
- [ ] CI/CD pipeline complet fonctionne
- [ ] Monitoring affiche m√©triques
- [ ] Alertes se d√©clenchent
- [ ] Backup/restore fonctionne
- [ ] Documentation compl√®te et claire
- [ ] Secrets g√©r√©s correctement
- [ ] Tests passent

## Notes importantes

1. **Coh√©rence:** Les variables doivent √™tre coh√©rentes entre Terraform, Ansible et Docker
2. **Secrets:** JAMAIS de secrets en clair dans le code
3. **Production-ready:** Tout doit √™tre pens√© pour la production d√®s le d√©but
4. **Documentation:** Chaque d√©cision importante doit √™tre document√©e
5. **Tests:** Tester sur staging avant production
6. **Versioning:** Tout doit √™tre versionn√© (Git)
7. **Idempotence:** Ansible doit √™tre idempotent
8. **Monitoring:** Tout doit √™tre monitor√©
9. **Backup:** Tout doit √™tre sauvegard√©
10. **Security:** Security by default

## Livrables attendus

√Ä la fin, tu dois avoir:
- Infrastructure compl√®te d√©ployable
- CI/CD fonctionnel
- Monitoring op√©rationnel
- Documentation exhaustive
- Tous les scripts n√©cessaires
- Configuration 3 environnements
- Tests automatis√©s
- Security hardening

Bonne chance ! üöÄ