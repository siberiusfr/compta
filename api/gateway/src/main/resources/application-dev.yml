# Development profile configuration
spring:
  config:
    activate:
      on-profile: dev

  # ✅ Rate limiting configuration for dev (plus permissif)
  cloud:
    gateway.server.webflux:
      default-filters:
        - name: RequestRateLimiter
          args:
            redis-rate-limiter.replenishRate: 1000 # Plus permissif en dev
            redis-rate-limiter.burstCapacity: 2000
            key-resolver: '#{@userKeyResolver}'

# Development service URLs (localhost)
AUTH_SERVICE_URL: http://localhost:8081
AUTHZ_SERVICE_URL: http://localhost:8082
INVOICE_SERVICE_URL: http://localhost:8083
EMPLOYEE_SERVICE_URL: http://localhost:8084

# ✅ CORS - Allow all local development ports
cors:
  allowed-origins:
    - http://localhost:3000 # React/Vue
    - http://localhost:4200 # Angular
    - http://localhost:5173 # Vite
    - http://localhost:8080 # Gateway itself
    - http://localhost:8081 # Auth service
  max-age: 3600

# ✅ Gateway URLs pour OpenAPI
gateway:
  url:
    dev: http://localhost:8080

# Enable Swagger in dev
springdoc:
  swagger-ui:
    enabled: true
  api-docs:
    enabled: true

# Verbose logging for debugging
logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG
    reactor.netty.http.client: DEBUG
    tn.compta.gateway: DEBUG
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - [traceId=%X{traceId} spanId=%X{spanId}] %msg%n'

# Show detailed actuator info
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      exposure:
        include: '*' # Expose all endpoints in dev
  # Full tracing in dev
  tracing:
    sampling:
      probability: 1.0
