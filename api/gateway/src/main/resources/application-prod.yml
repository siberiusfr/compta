# Production profile configuration
spring:
  config:
    activate:
      on-profile: prod

  cloud:
    gateway.server.webflux:
      # ✅ Enable global filters
      # ✅ Global timeouts
      httpclient:
        connect-timeout: 5000 # 5 seconds
        response-timeout: 30s # 30 seconds
        pool:
          max-connections: 500
          acquire-timeout: 45000
      default-filters:
        # Remove hop-by-hop headers
        - RemoveRequestHeader=Cookie
        - RemoveRequestHeader=Set-Cookie
        # Note: Security headers are handled by SecurityHeadersFilter
        # Note: Rate limiting is configured per-route in application.yml

# ⚠️ JWT secret MUST be provided via environment variable in production
# DO NOT use default value in production!
jwt:
  secret: ${JWT_SECRET} # ✅ No default value - will fail if not set
  expiration: ${JWT_EXPIRATION:3600000} # 1 hour default
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7 days

# Production service URLs (use environment variables)
AUTH_SERVICE_URL: ${AUTH_SERVICE_URL}
AUTHZ_SERVICE_URL: ${AUTHZ_SERVICE_URL}
INVOICE_SERVICE_URL: ${INVOICE_SERVICE_URL}
EMPLOYEE_SERVICE_URL: ${EMPLOYEE_SERVICE_URL}

# ✅ Gateway URLs pour OpenAPI
gateway:
  url:
    prod: ${GATEWAY_URL:https://api.compta.tn}

# Disable Swagger in production
springdoc:
  swagger-ui:
    enabled: false
  api-docs:
    enabled: false

# Reduced logging in production
logging:
  level:
    root: WARN
    tn.compta.gateway: INFO
    org.springframework.security: INFO
    org.springframework.cloud.gateway: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - [traceId=%X{traceId} spanId=%X{spanId}] %msg%n"

# Hide sensitive actuator info
management:
  endpoint:
    health:
      show-details: when-authorized
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  prometheus:
    metrics:
      export:
        enabled: true
  # Reduced sampling in production (10%)
  tracing:
    sampling:
      probability: 0.1

# Production CORS - ⚠️ IMPORTANT : À adapter selon vos domaines
cors:
  allowed-origins:
    - https://app.compta.tn
    - https://www.compta.tn
  max-age: 3600
